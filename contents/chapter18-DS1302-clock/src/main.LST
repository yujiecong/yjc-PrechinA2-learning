C51 COMPILER V9.01   MAIN                                                                  04/10/2019 14:10:25 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*************************************************************************************
   2          
   3          *
   4          实验现象：下载程序后，数码管显示红外遥控键值数据
   5                
   6          接线说明： (具体接线图可见开发攻略对应实验的“实验现象”章节)
   7                 1，单片机-->红外接收模块
   8                    P32-->J11
   9                 2，单片机-->动态数码管模块
  10                    J22-->J6
  11                  P22-->J9(A)
  12                  P23-->J9(B)
  13                  P24-->J9(C) 
  14            
  15          注意事项：红外遥控器上的电池绝缘隔片要拿掉                    
  16          
  17                                
  18          **************************************************************************************
  19          
  20          */
  21          
  22          #include "reg52.h"       //此文件中定义了单片机的一些特殊功能寄存器
  23            
  24          
  25          typedef unsigned int u16;   //对数据类型进行声明定义
  26          typedef unsigned char u8;
  27          
  28          sbit LSA=P2^2;
  29          sbit LSB=P2^3;
  30          sbit LSC=P2^4;
  31          
  32          sbit IRIN=P3^2;
  33          
  34          u8 IrValue[6];
  35          u8 Time;
  36          
  37          u8 DisplayData[8];
  38          u8 code smgduan[17]={
  39          0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  40          0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71,0X76};
  41          //0、1、2、3、4、5、6、7、8、9、A、b、C、d、E、F、H的显示码
  42          
  43          /*******************************************************************************
  44          * 函 数 名         : delay
  45          * 函数功能       : 延时函数，i=1时，大约延时10us
  46          *******************************************************************************/
  47          void delay(u16 i)
  48          {
  49   1        while(i--); 
  50   1      }
  51          
  52          
  53          /*******************************************************************************
  54          * 函数名         :DigDisplay()
  55          * 函数功能     :数码管显示函数
C51 COMPILER V9.01   MAIN                                                                  04/10/2019 14:10:25 PAGE 2   

  56          * 输入           : 无
  57          * 输出           : 无
  58          *******************************************************************************/
  59          void DigDisplay()
  60          {
  61   1        u8 i;
  62   1        for(i=0;i<3;i++)
  63   1        {
  64   2          switch(i)  //位选，选择点亮的数码管，
  65   2          {
  66   3            case(0):
  67   3              LSA=0;LSB=1;LSC=0; break;//显示第2位  
  68   3            case(1):
  69   3              LSA=1;LSB=0;LSC=0; break;//显示第1位
  70   3            case(2):
  71   3              LSA=0;LSB=0;LSC=0; break;//显示第0位 
  72   3          }
  73   2          P0=DisplayData[i];//发送数据
  74   2          delay(100); //间隔一段时间扫描  
  75   2          P0=0x00;//消隐
  76   2        }   
  77   1      }
  78          
  79          
  80          /*******************************************************************************
  81          * 函数名         : IrInit()
  82          * 函数功能       : 初始化红外线接收
  83          * 输入           : 无
  84          * 输出           : 无
  85          *******************************************************************************/
  86          
  87          void IrInit()
  88          {
  89   1        IT0=1;//下降沿触发
  90   1        EX0=1;//打开中断0允许
  91   1        EA=1; //打开总中断
  92   1      
  93   1        IRIN=1;//初始化端口
  94   1      }
  95          
  96          
  97          /*******************************************************************************
  98          * 函 数 名       : main
  99          * 函数功能     : 主函数
 100          * 输    入       : 无
 101          * 输    出       : 无
 102          *******************************************************************************/
 103          void main()
 104          { 
 105   1        IrInit();
 106   1        while(1)
 107   1        { 
 108   2          DisplayData[0] = smgduan[IrValue[2]/16];
 109   2          DisplayData[1] = smgduan[IrValue[2]%16];
 110   2          DisplayData[2] = smgduan[16];
 111   2            DigDisplay();   
 112   2        }   
 113   1      }
 114          
 115          /*******************************************************************************
 116          * 函数名         : ReadIr()
 117          * 函数功能       : 读取红外数值的中断函数
C51 COMPILER V9.01   MAIN                                                                  04/10/2019 14:10:25 PAGE 3   

 118          * 输入           : 无
 119          * 输出           : 无
 120          *******************************************************************************/
 121          
 122          void ReadIr() interrupt 0
 123          {
 124   1        u8 j,k;
 125   1        u16 err;
 126   1        Time=0;          
 127   1        delay(700); //7ms
 128   1        if(IRIN==0)   //确认是否真的接收到正确的信号
 129   1        {  
 130   2          
 131   2          err=1000;       //1000*10us=10ms,超过说明接收到错误的信号
 132   2          /*当两个条件都为真是循环，如果有一个条件为假的时候跳出循环，免得程序出错的时
 133   2          侯，程序死在这里*/  
 134   2          while((IRIN==0)&&(err>0)) //等待前面9ms的低电平过去     
 135   2          {     
 136   3            delay(1);
 137   3            err--;
 138   3          } 
 139   2          if(IRIN==1)     //如果正确等到9ms低电平
 140   2          {
 141   3            err=500;
 142   3            while((IRIN==1)&&(err>0))    //等待4.5ms的起始高电平过去
 143   3            {
 144   4              delay(1);
 145   4              err--;
 146   4            }
 147   3            for(k=0;k<4;k++)    //共有4组数据
 148   3            {       
 149   4              for(j=0;j<8;j++)  //接收一组数据
 150   4              {
 151   5      
 152   5                err=60;   
 153   5                while((IRIN==0)&&(err>0))//等待信号前面的560us低电平过去
 154   5                {
 155   6                  delay(1);
 156   6                  err--;
 157   6                }
 158   5                err=500;
 159   5                while((IRIN==1)&&(err>0))  //计算高电平的时间长度。
 160   5                {
 161   6                  delay(10);   //0.1ms
 162   6                  Time++;
 163   6                  err--;
 164   6                  if(Time>30)
 165   6                  {
 166   7                    return;
 167   7                  }
 168   6                }
 169   5                IrValue[k]>>=1;  //k表示第几组数据
 170   5                if(Time>=8)     //如果高电平出现大于565us，那么是1
 171   5                {
 172   6                  IrValue[k]|=0x80;
 173   6                }
 174   5                Time=0;   //用完时间要重新赋值              
 175   5              }
 176   4            }
 177   3          }
 178   2          if(IrValue[2]!=~IrValue[3])
 179   2          {
C51 COMPILER V9.01   MAIN                                                                  04/10/2019 14:10:25 PAGE 4   

 180   3            return;
 181   3          }
 182   2        }     
 183   1      }
 184          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    339    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
